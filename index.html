<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Notas</title>
  <style>
    :root{
      --bg0:#000;
      --bg1:#050507;
      --glass: rgba(28,28,30,.72);
      --glass-2: rgba(44,44,46,.78);
      --glass-3: rgba(58,58,60,.88);
      --line: rgba(255,255,255,.08);
      --text:#fff;
      --muted:#a1a1a6;
      --muted-2:#8e8e93;
      --accent:#ffd60a;
      --danger:#ff453a;
      --blue:#0a84ff;
      --font:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      --shadow: 0 18px 50px rgba(0,0,0,.65);
      --glow: inset 0 1px 0 rgba(255,255,255,.06), inset 0 -1px 0 rgba(0,0,0,.5);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% -10%, #1a1a1c 0%, transparent 55%),
        radial-gradient(900px 700px at 110% 10%, #141416 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      color:var(--text);
      font-family:var(--font);
      -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }
    .glass{
      background:var(--glass);
      backdrop-filter:saturate(180%) blur(22px);
      -webkit-backdrop-filter:saturate(180%) blur(22px);
      border:1px solid var(--line);
      box-shadow:var(--shadow), var(--glow);
    }
    .glass-2{ background:var(--glass-2); }
    .glass-3{ background:var(--glass-3); }
    .app{position:fixed;inset:0;display:flex;flex-direction:column;}
    .nav{
      height:48px;flex:0 0 auto;
      display:flex;align-items:center;gap:6px;
      padding:0 10px;
      position:relative;z-index:30;
    }
    .nav .title{
      font-weight:700;font-size:17px;letter-spacing:.2px;
      color:var(--text);margin:0 auto;pointer-events:none;
      max-width:60%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .nav .left,.nav .right{display:flex;align-items:center;gap:2px;min-width:72px;}
    .nav .right{justify-content:flex-end}
    .nav-btn{
      background:transparent;border:0;color:var(--accent);
      font-size:16px;font-weight:600;padding:6px 8px;border-radius:8px;cursor:pointer;
    }
    .nav-btn.blue{ color:var(--blue); }
    .nav-btn:active{background:#00000040}
    .main{position:relative;flex:1;min-height:0;overflow:hidden;}
    .screen{
      position:absolute;inset:0;display:flex;flex-direction:column;min-height:0;
      transition:transform .28s cubic-bezier(.2,.8,.2,1);
    }
    #foldersScreen{transform:translateX(0);z-index:5;}
    #notesScreen{transform:translateX(100%);z-index:1;}
    .show-notes #foldersScreen{transform:translateX(-100%);}
    .show-notes #notesScreen{transform:translateX(0);}
    .folders-wrap{flex:1;min-height:0;overflow:auto;padding:10px 10px 90px;}
    .section-title{
      color:var(--muted);font-weight:800;font-size:12px;letter-spacing:.5px;text-transform:uppercase;
      padding:12px 6px 6px;
    }
    .folder-cell{
      display:flex;align-items:center;gap:10px;
      padding:12px 14px;margin-bottom:8px;border-radius:14px;cursor:pointer;
    }
    .folder-icon{
      width:24px;height:18px;border-radius:5px;background:var(--accent);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.35);
      flex:0 0 auto;
    }
    .folder-name{font-size:16px;font-weight:700;}
    .folder-count{margin-left:auto;color:var(--muted-2);font-weight:800;font-size:13px;}
    .folder-actions{display:none;gap:6px;margin-left:6px;}
    .edit-mode .folder-actions{display:flex;}
    .mini-btn{
      width:28px;height:28px;border-radius:8px;border:0;cursor:pointer;
      display:grid;place-items:center;font-size:14px;
      background:var(--glass-2);color:var(--text);border:1px solid var(--line);
    }
    .mini-btn.danger{color:var(--danger);background:#3a2020;}
    .sidebar{
      position:absolute;top:0;bottom:0;left:0;width:min(86vw,340px);
      display:flex;flex-direction:column;min-height:0;transform:translateX(-100%);
      transition:transform .28s cubic-bezier(.2,.8,.2,1);z-index:6;
    }
    .sidebar.open{transform:translateX(0);}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:5;}
    .overlay.show{opacity:1;pointer-events:auto;}
    .search-row{padding:8px 10px;display:flex;flex-direction:column;gap:8px;}
    .search{
      width:100%;border:1px solid transparent;color:var(--text);
      padding:9px 10px;font-size:15px;border-radius:10px;outline:none;
      background:rgba(255,255,255,.06);
    }
    .search::placeholder{color:var(--muted-2)}
    .count{font-size:12px;color:var(--muted-2);font-weight:800;padding:0 2px;}
    .list{flex:1;min-height:0;overflow:auto;padding:8px 8px 90px;}
    .note-cell{
      padding:10px 12px;margin-bottom:6px;border-radius:12px;cursor:pointer;
      transition:background .12s ease,transform .02s ease;border:1px solid transparent;
    }
    .note-cell:hover{background:rgba(255,255,255,.04);}
    .note-cell:active{background:rgba(255,255,255,.07);transform:translateY(1px);}
    .note-title{
      font-size:16px;font-weight:700;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;
    }
    .note-meta{font-size:12px;color:var(--muted-2);font-weight:700;display:flex;gap:6px;align-items:center;}
    .note-preview{font-size:14px;color:#d1d1d6;margin-top:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .editor{position:absolute;inset:0;display:flex;flex-direction:column;min-height:0;z-index:1;}
    .editor-top{
      padding:6px 8px;display:flex;align-items:center;gap:8px;
      border-bottom:1px solid var(--line);
    }
    .editor-top .date{
      font-size:12px;color:var(--muted);font-weight:900;
      padding:6px 8px;border-radius:8px;background:rgba(255,255,255,.06);
    }
    .editor-top .actions{margin-left:auto;display:flex;gap:6px;}
    .icon-btn{
      width:34px;height:34px;border-radius:9px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);color:var(--text);font-size:16px;cursor:pointer;
      display:grid;place-items:center;
    }
    .icon-btn:active{transform:translateY(1px);}
    textarea{
      flex:1;min-height:0;width:100%;background:transparent;color:var(--text);
      border:0;outline:none;resize:none;font-family:var(--font);
      font-size:18px;line-height:1.55;padding:16px 14px 120px;caret-color:var(--accent);
    }
    textarea::placeholder{color:var(--muted-2)}
    .empty{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:var(--muted);text-align:center;padding:30px;}
    .empty .big{font-size:20px;font-weight:800;color:var(--text);opacity:.9;}
    .fab{
      position:absolute;right:18px;bottom:18px;width:56px;height:56px;border-radius:16px;
      background:var(--accent);color:#000;font-size:26px;font-weight:900;display:grid;place-items:center;border:0;cursor:pointer;
      box-shadow:0 14px 38px rgba(0,0,0,.6);z-index:2;
    }
    .fab:active{transform:translateY(1px);}
    .sheet-wrap{
      position:absolute; inset:0; display:none; place-items:end center; z-index:50;
      background:rgba(0,0,0,.35);
    }
    .sheet-wrap.show{ display:grid; }
    .sheet{
      width:min(96vw, 420px); padding:10px; margin:0 0 12px;
      border-radius:16px;
    }
    .sheet .group{ border-radius:14px; overflow:hidden; }
    .sheet .row{
      padding:14px 14px; font-size:17px; font-weight:600; color:var(--text);
      display:flex; align-items:center; justify-content:center; gap:8px;
      border-bottom:1px solid var(--line); cursor:pointer;
      background:rgba(255,255,255,.04);
    }
    .sheet .row:last-child{ border-bottom:0; }
    .sheet .row.danger{ color:var(--danger); }
    .sheet .row.muted{ color:var(--muted); font-weight:700; font-size:14px; cursor:default; }
    .sheet .cancel{ margin-top:8px; border-radius:14px; }
    @media (min-width:980px){
      body{overflow:auto;}
      .app{position:relative;height:100vh;}
      #foldersScreen{display:none;}
      #notesScreen{transform:none;position:relative;inset:auto;}
      .main{display:grid;grid-template-columns:360px 1fr;}
      .sidebar{position:relative;transform:none !important;width:auto;z-index:1;}
      .overlay{display:none;}
      .editor{position:relative;}
    }
  </style>
</head>
<body>
<div class="app glass" id="appRoot">

  <div class="nav glass" id="navBar">
    <div class="left">
      <button class="nav-btn" id="leftBtn">Carpetas</button>
    </div>
    <div class="title" id="navTitle">Carpetas</div>
    <div class="right">
      <button class="nav-btn blue" id="editBtn">Editar</button>
      <button class="nav-btn" id="moreBtn" style="display:none;">‚Ä¢‚Ä¢‚Ä¢</button>
    </div>
  </div>

  <div class="main" id="main">
    <section class="screen" id="foldersScreen">
      <div class="folders-wrap" id="foldersList"></div>
      <button class="fab" id="newFolderFab" title="Nueva carpeta">üìÅ</button>
    </section>

    <section class="screen" id="notesScreen">
      <aside class="sidebar glass" id="sidebar">
        <div class="search-row">
          <input class="search" id="searchInput" placeholder="Buscar" />
          <div class="count" id="countLabel">0 notas</div>
        </div>
        <div class="list" id="list"></div>
      </aside>

      <div class="overlay" id="overlay"></div>

      <section class="editor" id="editor">
        <div class="editor-top glass" id="editorTop" style="display:none;">
          <div class="date" id="dateLabel"></div>
          <div class="actions">
            <button class="icon-btn" id="noteMoreBtn" title="M√°s">‚Ä¢‚Ä¢‚Ä¢</button>
          </div>
        </div>

        <div class="empty" id="emptyState">
          <div class="big">Sin nota seleccionada</div>
          <div>Abre el panel lateral para elegir una nota.</div>
        </div>

        <button class="fab" id="newNoteFab" title="Nueva nota">‚úé</button>
      </section>
    </section>
  </div>

  <div class="sheet-wrap" id="sheetWrap">
    <div class="sheet">
      <div class="group glass-2 glass" id="sheetGroup"></div>
      <div class="group glass-2 glass cancel">
        <div class="row" id="sheetCancel">Cancelar</div>
      </div>
    </div>
  </div>

</div>

<script>
  const STORAGE_KEY = "notas_ios_glass_v6";

  const seed = {
    folders: [
      { id:"f-icloud-notas", name:"Notas", location:"icloud", ts: Date.now()-2*86400000 },
      { id:"f-icloud-magia", name:"Magia", location:"icloud", ts: Date.now()-12*86400000 },
      { id:"f-iphone-personal", name:"Personal", location:"onmyiphone", ts: Date.now()-35*86400000 },
      { id:"f-iphone-coches", name:"Coches", location:"onmyiphone", ts: Date.now()-120*86400000 }
    ],
    notes: [
      { folderId:"f-icloud-notas", body:`Marcas de coches\n- Mercedes-Benz\n- BMW\n- Audi\n- Volkswagen\n- Porsche\n- Ferrari\n- Lamborghini\n- Toyota\n- Honda\n- Hyundai\n- Kia\n- Renault\n- Peugeot\n- SEAT\n- Tesla\n- BYD\n- Volvo\n- Ford\n- Chevrolet\n- Lexus`, ts:Date.now()-1*86400000 },
      { folderId:"f-icloud-magia", body:`Canciones para rutinas\n- Billie Jean ‚Äî Michael Jackson\n- Bohemian Rhapsody ‚Äî Queen\n- Blinding Lights ‚Äî The Weeknd\n- Viva la Vida ‚Äî Coldplay\n- Shape of You ‚Äî Ed Sheeran\n- Hysteria ‚Äî Muse\n- Lose Yourself ‚Äî Eminem\n- Titanium ‚Äî David Guetta ft. Sia\n- La Flaca ‚Äî Jarabe de Palo\n- Mi Gran Noche ‚Äî Raphael`, ts:Date.now()-2*86400000 },
      { folderId:"f-icloud-magia", body:`Trucos (ideas r√°pidas)\n- Predicci√≥n en notas\n- Forzaje de canci√≥n\n- Doble realidad con NFC\n- Final con revelaci√≥n en iPhone`, ts:Date.now()-3*86400000 },
      { folderId:"f-iphone-personal", body:`Pa√≠ses por continentes\nEuropa:\n- Espa√±a, Francia, Italia, Alemania, Portugal, Reino Unido\n\nAm√©rica:\n- Canad√°, Estados Unidos, M√©xico, Colombia, Argentina, Chile, Brasil\n\nAsia:\n- Jap√≥n, China, Corea del Sur, India\n\n√Åfrica:\n- Marruecos, Egipto, Senegal, Nigeria\n\nOcean√≠a:\n- Australia, Nueva Zelanda`, ts:(new Date(2025,6,15)).getTime() },
      { folderId:"f-iphone-coches", body:`Coches que quiero mirar\n- CLA 45 2013\n- CLA 250 2013\n- BMW 420i 2017\n- C220d 2016`, ts:(new Date(2025,5,3)).getTime() },
    ]
  };

  let folders = [];
  let notes = [];
  let activeFolderId = null;
  let activeNoteId = null;
  let editMode = false;

  const appRoot = document.getElementById("appRoot");
  const navTitle = document.getElementById("navTitle");
  const leftBtn = document.getElementById("leftBtn");
  const editBtn = document.getElementById("editBtn");
  const moreBtn = document.getElementById("moreBtn");

  const foldersList = document.getElementById("foldersList");
  const newFolderFab = document.getElementById("newFolderFab");

  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const listEl = document.getElementById("list");
  const searchInput = document.getElementById("searchInput");
  const countLabel = document.getElementById("countLabel");

  const editorEl = document.getElementById("editor");
  const editorTopEl = document.getElementById("editorTop");
  const emptyStateEl = document.getElementById("emptyState");
  const dateLabel = document.getElementById("dateLabel");
  const newNoteFab = document.getElementById("newNoteFab");
  const noteMoreBtn = document.getElementById("noteMoreBtn");

  const sheetWrap = document.getElementById("sheetWrap");
  const sheetGroup = document.getElementById("sheetGroup");
  const sheetCancel = document.getElementById("sheetCancel");

  function isDesktop(){ return window.matchMedia("(min-width: 980px)").matches; }
  function uid(prefix){ return (prefix||"id")+ "-" + Math.random().toString(36).slice(2) + Date.now().toString(36); }
  function nowTs(){ return Date.now(); }

  function firstLine(text){
    const l = (text || "").split("\n").map(s=>s.trim()).find(Boolean);
    return l || "Sin t√≠tulo";
  }
  function preview(text){
    const lines = (text || "").split("\n").map(s=>s.trim()).filter(Boolean);
    if(lines.length<=1) return (lines[0]||"");
    return lines.slice(1).join(" ").slice(0, 90);
  }
  function fmtDate(ts){
    const d = new Date(ts);
    return d.toLocaleDateString("es-ES",{ day:"2-digit", month:"short", year:"numeric" });
  }
  function sortNotes(arr){ return arr.slice().sort((a,b)=> b.updatedAt - a.updatedAt); }
  function groupLabel(ts){
    const diff = nowTs() - ts, seven = 7*24*60*60*1000;
    if(diff<=seven) return "√öLTIMOS 7 D√çAS";
    const d=new Date(ts);
    return d.toLocaleDateString("es-ES",{ month:"long", year:"numeric" }).toUpperCase();
  }
  function notesInFolder(fid){ return notes.filter(n=>n.folderId===fid); }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){
      folders = seed.folders.map(f=>({
        id:f.id, name:f.name, location:f.location,
        createdAt:f.ts, updatedAt:f.ts
      }));
      notes = seed.notes.map(n=>({
        id:uid("n"), folderId:n.folderId, body:n.body,
        createdAt:n.ts, updatedAt:n.ts
      }));
      save(); return;
    }
    try{
      const data = JSON.parse(raw)||{};
      folders = data.folders||[];
      notes = data.notes||[];
    }catch(e){
      folders=[]; notes=[];
    }
  }
  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify({folders, notes}));
  }

  function showFolders(){
    appRoot.classList.remove("show-notes");
    navTitle.textContent = "Carpetas";
    leftBtn.textContent = "Carpetas";
    editBtn.style.display = "inline-block";
    moreBtn.style.display = "none";
    newFolderFab.style.display = "grid";
    newNoteFab.style.display = "none";
    closeSidebar();
    activeFolderId = null;
    activeNoteId = null;
    renderFolders();
    renderEditor();
  }

  function showNotes(folderId){
    activeFolderId = folderId;
    appRoot.classList.add("show-notes");
    const f = folders.find(x=>x.id===folderId);
    navTitle.textContent = f?.name || "Notas";
    leftBtn.textContent = "Carpetas";
    editBtn.style.display = "none";
    moreBtn.style.display = "inline-block";
    newFolderFab.style.display = "none";
    newNoteFab.style.display = "grid";
    renderList();
    if(!isDesktop()) openSidebar();
  }

  function renderFolders(){
    foldersList.innerHTML = "";
    appRoot.classList.toggle("edit-mode", editMode);

    const icloud = folders.filter(f=>f.location==="icloud");
    const iphone = folders.filter(f=>f.location==="onmyiphone");

    function section(title, list){
      const h=document.createElement("div");
      h.className="section-title";
      h.textContent=title;
      foldersList.appendChild(h);

      list.forEach(f=>{
        const cell=document.createElement("div");
        cell.className="folder-cell glass glass-2";
        cell.onclick=()=> showNotes(f.id);

        const count=notesInFolder(f.id).length;
        cell.innerHTML=`
          <div class="folder-icon"></div>
          <div class="folder-name">${f.name}</div>
          <div class="folder-count">${count}</div>
          <div class="folder-actions">
            <button class="mini-btn" data-act="rename">‚úèÔ∏è</button>
            <button class="mini-btn danger" data-act="delete">‚àí</button>
          </div>
        `;
        if(editMode){
          cell.querySelectorAll(".mini-btn").forEach(b=>{
            b.onclick=(e)=>{
              e.stopPropagation();
              const act=b.dataset.act;
              if(act==="rename") renameFolder(f.id);
              if(act==="delete") deleteFolder(f.id);
            };
          });
        }
        foldersList.appendChild(cell);
      });
    }

    section("iCLOUD", icloud);
    section("EN MI IPHONE", iphone);
  }

  function createFolder(){
    const name = prompt("Nombre de la carpeta:");
    if(!name) return;
    const loc = prompt("¬øD√≥nde? Escribe: icloud  /  iphone", "icloud");
    const location = (loc||"icloud").toLowerCase().includes("iphone") ? "onmyiphone" : "icloud";
    const f={ id:uid("f"), name:name.trim(), location, createdAt:nowTs(), updatedAt:nowTs() };
    folders.push(f); save(); renderFolders();
  }

  function renameFolder(id){
    const f=folders.find(x=>x.id===id); if(!f) return;
    const name = prompt("Renombrar carpeta:", f.name);
    if(!name) return;
    f.name=name.trim(); f.updatedAt=nowTs();
    save(); renderFolders();
    if(activeFolderId===id) navTitle.textContent=f.name;
  }

  function deleteFolder(id){
    const f=folders.find(x=>x.id===id); if(!f) return;
    const count=notesInFolder(id).length;
    if(!confirm(`¬øEliminar carpeta "${f.name}"?\nSe borrar√°n ${count} notas.`)) return;
    notes = notes.filter(n=>n.folderId!==id);
    folders = folders.filter(x=>x.id!==id);
    save(); renderFolders();
  }

  function renderList(){
    const q = searchInput.value.trim().toLowerCase();
    const filtered = sortNotes(notesInFolder(activeFolderId))
      .filter(n=>(n.body||"").toLowerCase().includes(q));

    listEl.innerHTML="";
    let lastGroup=null;

    filtered.forEach(n=>{
      const g=groupLabel(n.updatedAt);
      if(g!==lastGroup){
        const h=document.createElement("div");
        h.className="section-title";
        h.textContent=g;
        listEl.appendChild(h);
        lastGroup=g;
      }
      const cell=document.createElement("div");
      cell.className="note-cell glass glass-2";
      cell.onclick=()=>openNote(n.id);
      cell.innerHTML=`
        <div class="note-title">${firstLine(n.body)}</div>
        <div class="note-meta">
          <span>${fmtDate(n.updatedAt)}</span><span>‚Ä¢</span>
          <span>${(n.body||"").length} caracteres</span>
        </div>
        <div class="note-preview">${preview(n.body)}</div>
      `;
      listEl.appendChild(cell);
    });

    countLabel.textContent = `${filtered.length} nota${filtered.length!==1?"s":""}`;
  }

  function clearEditor(){
    const oldTa=editorEl.querySelector("textarea");
    if(oldTa) oldTa.remove();
  }

  function renderEditor(){
    clearEditor();
    const note=notes.find(n=>n.id===activeNoteId);
    if(!note){
      editorTopEl.style.display="none";
      emptyStateEl.style.display="flex";
      return;
    }
    emptyStateEl.style.display="none";
    editorTopEl.style.display="flex";
    dateLabel.textContent=fmtDate(note.updatedAt);

    const ta=document.createElement("textarea");
    ta.placeholder="Escribe tu nota‚Ä¶";
    ta.value=note.body||"";
    ta.oninput=()=>{
      note.body=ta.value;
      note.updatedAt=nowTs();
      save(); renderList();
      dateLabel.textContent=fmtDate(note.updatedAt);
    };
    editorEl.insertBefore(ta, newNoteFab);
    setTimeout(()=>ta.focus(),0);
  }

  function createNote(){
    if(!activeFolderId) return;
    const n={ id:uid("n"), folderId:activeFolderId, body:"", createdAt:nowTs(), updatedAt:nowTs() };
    notes.push(n); save();
    activeNoteId=n.id;
    renderList(); renderEditor();
    if(!isDesktop()) closeSidebar();
  }

  function openNote(id){
    activeNoteId=id; renderEditor();
    if(!isDesktop()) closeSidebar();
  }

  function deleteNote(id){
    const n=notes.find(x=>x.id===id); if(!n) return;
    const title=firstLine(n.body||"");
    if(!confirm(`¬øEliminar nota?\n"${title}"`)) return;
    notes=notes.filter(x=>x.id!==id);
    activeNoteId=null;
    save(); renderList(); renderEditor();
  }

  function moveNote(id){
    const n=notes.find(x=>x.id===id); if(!n) return;
    const choices=folders.map(f=>`${f.name} (${f.location==="icloud"?"iCloud":"iPhone"})`).join("\n");
    const name=prompt("Mover a carpeta (escribe el nombre exacto):\n"+choices);
    if(!name) return;
    const target=folders.find(f=>f.name.toLowerCase()===name.toLowerCase());
    if(!target){ alert("No encontrada."); return; }
    n.folderId=target.id; n.updatedAt=nowTs();
    save();
    if(target.id!==activeFolderId){
      activeNoteId=null;
      renderList(); renderEditor();
    }else{
      renderList();
    }
  }

  function openSidebar(){ sidebar.classList.add("open"); overlay.classList.add("show"); }
  function closeSidebar(){ sidebar.classList.remove("open"); overlay.classList.remove("show"); }
  overlay.onclick=closeSidebar;

  function showSheet(rows){
    sheetGroup.innerHTML="";
    rows.forEach(r=>{
      const row=document.createElement("div");
      row.className="row"+(r.danger?" danger":"")+(r.muted?" muted":"");
      row.textContent=r.label;
      if(!r.muted){
        row.onclick=()=>{ hideSheet(); r.onClick?.(); };
      }
      sheetGroup.appendChild(row);
    });
    sheetWrap.classList.add("show");
  }
  function hideSheet(){ sheetWrap.classList.remove("show"); }
  sheetCancel.onclick=hideSheet;
  sheetWrap.onclick=(e)=>{ if(e.target===sheetWrap) hideSheet(); };

  leftBtn.onclick=()=> showFolders();

  editBtn.onclick=()=>{
    editMode=!editMode;
    editBtn.textContent = editMode ? "Hecho" : "Editar";
    renderFolders();
  };

  moreBtn.onclick=()=>{
    const f=folders.find(x=>x.id===activeFolderId);
    showSheet([
      {label:f?.name||"Carpeta", muted:true},
      {label:"Renombrar carpeta", onClick:()=>renameFolder(activeFolderId)},
      {label:"Eliminar carpeta", danger:true, onClick:()=>{ deleteFolder(activeFolderId); showFolders(); }},
    ]);
  };

  noteMoreBtn.onclick=()=>{
    const id=activeNoteId;
    if(!id) return;
    showSheet([
      {label:firstLine(notes.find(n=>n.id===id)?.body||""), muted:true},
      {label:"Mover a carpeta‚Ä¶", onClick:()=>moveNote(id)},
      {label:"Duplicar nota", onClick:()=>{
        const n=notes.find(x=>x.id===id);
        if(!n) return;
        const copy={...n, id:uid("n"), createdAt:nowTs(), updatedAt:nowTs()};
        notes.push(copy); save(); renderList();
      }},
      {label:"Copiar texto", onClick:()=>{
        const txt=notes.find(x=>x.id===id)?.body||"";
        navigator.clipboard?.writeText(txt);
      }},
      {label:"Eliminar nota", danger:true, onClick:()=>deleteNote(id)},
    ]);
  };

  newFolderFab.onclick=createFolder;
  newNoteFab.onclick=createNote;
  searchInput.oninput=renderList;

  load();
  showFolders();
  renderFolders();
  renderEditor();

  window.addEventListener("resize", ()=>{
    if(isDesktop()){
      if(activeFolderId) appRoot.classList.add("show-notes");
      closeSidebar();
    }
  });
</script>
</body>
</html>
